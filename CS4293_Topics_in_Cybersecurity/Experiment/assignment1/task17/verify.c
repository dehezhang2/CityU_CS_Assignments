#include <stdio.h>
#include <openssl/bn.h>
#define NBITS 256
void printBN(char *msg, BIGNUM * a)
{
	/* Use BN_bn2hex(a) for hex string
	* Use BN_bn2dec(a) for decimal string */
	char * number_str = BN_bn2hex(a);
	printf("%s %s\n", msg, number_str);
	OPENSSL_free(number_str);
}

int main ()
{
	BN_CTX *ctx = BN_CTX_new();
	BIGNUM *n = BN_new();
	BIGNUM *e = BN_new();
	BIGNUM *S = BN_new();
	BIGNUM *d = BN_new();
	BIGNUM *M = BN_new();

	// Initialization
	BN_hex2bn(&n, "D081C13923C2B1D1ECF757DD55243691202248F7FCCA520AB0AB3F33B5B08407F6DF4E7AB0FB98223D01AC56FB716DB2EEB9A00F5277AB9893BE338AEB875EC7AAB0CA698F43086A3F22BF333946D594F2E24C0522D9678091F1044A0E9B7CA2C9D26CFD3C0984BDFD6B149A811DE78A83EF6116754798133B0D901698BF8AE22732539999C3FB961C35F762ED8CBD4971D24343A1A1E3212A2370A8753DB26C4606616F1867E4297EB23CC1C55F091E6E444EEC2199581548F455482AB734B405E37C498C0058DE3A96CC39DC613355CE2A2E3FD19962E8AAE6347631AAAF79299678CB8114AF69DAFB04B9598344AA094FB4D42C019D9B94316B2DA1CFC1E5");
	BN_hex2bn(&e, "010001");
	BN_hex2bn(&S, "6456cd60979eb0d5174901b7fbb176f442a4f598ec5a7253f7a80ebdc6afd508d9276a3a16943a63a35c83d6aa914e252a94a3fa9fa934835ac865bc304b82985e43cea38aaab0042a470816de13cdab4b35a77ea58db1552fd4bdd5306b5c604375baea65a946cb2be073dcd9ce6b6d8174bb24f6a7cfdce422a2235516413787d825100b4a6c3cc5da90179d61a37550ed8de38d1ed2734355bac33f4b03ce3325060bdc251d0e1a34f5b95a6042d1f4369ca6bc3bc84bffd03db5ae936a7af4055d568287dee86fcda2c4c757a059e5ddfc86a4a05cb11e2bf7d181ed5c275f0f84beb2227ba5ca357dfa9133a2a786fa861d041604a6e27420767d9f08ce");
	// BN_hex2bn(&S, "643D6F34902D9C7EC90CB0B2BCA36C47FA37165C0005CAB026C0542CBDB6803F");

	// M = S^e mod n
	BN_mod_exp(M, S, e, n, ctx);
	printBN("", M);
	return 0;
}
